# -*- coding: utf-8 -*-
module E164
  def self.split_number(number, default_country_code = "")
    if is_a_number?(number)
      number = sanitize_number(number)
      if has_prefix?(number)
        a = []
        5.times { |i| a << number[1, i + 1] if COUNTRY_CODES.include? number[1, i + 1].to_i }
        return nil if a.empty?
        ["+#{a.last}", number[(a.last.size + 1)..(number.size)]]
      else
        [default_country_code, number]
      end
    else
      nil
    end
  end

  def self.sanitize_number(number)
    number.gsub(/\s|-|\(|\)/, "")
  end

  def self.has_prefix?(number)
    sanitize_number(number)[0,1] == "+"
  end

  def self.is_a_number?(number)
    number = sanitize_number(number)
    number =~ /(?:\+\d)?\d+/ and number.size <= 16
  end

  COUNTRY_CODES = [1, 7,  20, 27, 30, 31, 32, 33, 34,  36, 39, 40, 41,
                   43, 44, 45, 46, 47, 48, 49, 51, 52, 53, 54, 55, 56,
                   57, 58, 60, 61, 62, 63, 64, 65, 66, 81, 82, 84, 86,
                   90, 91,  92, 93,  94, 95, 98,  212, 213,  216, 218,
                   220, 221,  222, 223, 224, 225, 226,  227, 228, 229,
                   230, 231,  232, 233, 234, 235, 236,  237, 238, 239,
                   240, 241,  242, 243, 244, 245, 246,  247, 248, 249,
                   250, 251,  252, 253, 254, 255, 256,  257, 258, 260,
                   261, 262,  263, 264, 265, 266, 267,  268, 269, 290,
                   291, 297,  298, 299, 350, 351, 352,  353, 354, 355,
                   356, 357,  358, 359, 370, 371, 372,  373, 374, 375,
                   376, 377,  378, 379, 380, 381, 382,  385, 386, 387,
                   389, 420,  421, 423, 500, 501, 502,  503, 504, 505,
                   506, 507,  508, 509, 590, 591, 592,  593, 594, 595,
                   596, 597,  598, 599, 618, 670, 672,  673, 674, 675,
                   676, 677,  678, 679, 680, 681, 682,  683, 685, 686,
                   687, 688,  689, 690, 691, 692, 800,  808, 850, 852,
                   853, 855,  856, 870, 871, 872, 873,  874, 878, 880,
                   881, 886,  960, 961, 962, 963, 964,  965, 966, 967,
                   968, 970,  971, 972, 973, 974, 975,  976, 977, 992,
                   993, 994,  995, 996,  998, 1242, 1246,  1264, 1268,
                   1284,  1340, 1345,  1441, 1473,  1649,  1664, 1670,
                   1671,  1684, 1758,  1767, 1784,  1787,  1808, 1809,
                   1829,  1868, 1869,  1876, 1939,  5399,  8810, 8811,
                   8812, 8813, 8816, 8817, 8818, 8819, 88213, 88216]

  COUNTRIES = [["Afghanistan (+93)", "+93"],
               ["Albania (+355)", "+355"],
               ["Algeria (+213)", "+213"],
               ["American Samoa (+1684)", "+1684"],
               ["Andorra  (+376)", "+376"],
               ["Angola  (+244)", "+244"],
               ["Anguilla (+1264)", "+1264"],
               ["Antarctica (+672)", "+672"],
               ["Antigua (+1268)", "+1268"],
               ["Argentina  (+54)", "+54"],
               ["Armenia  (+374)", "+374"],
               ["Aruba (+297)", "+297"],
               ["Ascension (+247)", "+247"],
               ["Australia  (+61)", "+61"],
               ["Australian External Territories (+672)", "+672"],
               ["Austria (+43)", "+43"],
               ["Azerbaijan (+994)", "+994"],
               ["Bahamas (+1242)", "+1242"],
               ["Bahrain (+973)", "+973"],
               ["Bangladesh (+880)", "+880"],
               ["Barbados (+1246)", "+1246"],
               ["Barbuda (+1268)", "+1268"],
               ["Belarus (+375)", "+375"],
               ["Belgium (+32)", "+32"],
               ["Belize (+501)", "+501"],
               ["Benin (+229)", "+229"],
               ["Bermuda (+1441)", "+1441"],
               ["Bhutan (+975)", "+975"],
               ["Bolivia  (+591)", "+591"],
               ["Bosnia & Herzegovina  (+387)", "+387"],
               ["Botswana (+267)", "+267"],
               ["Brazil (+55)", "+55"],
               ["British Virgin Islands (+1284)", "+1284"],
               ["Brunei Darussalam (+673)", "+673"],
               ["Bulgaria (+359)", "+359"],
               ["Burkina Faso  (+226)", "+226"],
               ["Burundi (+257)", "+257"],
               ["Cambodia (+855)", "+855"],
               ["Cameroon (+237)", "+237"],
               ["Canada (+1)", "+1"],
               ["Cape Verde Islands (+238)", "+238"],
               ["Cayman Islands (+1345)", "+1345"],
               ["Central African Republic (+236)", "+236"],
               ["Chad (+235)", "+235"],
               ["Chatham Island (New Zealand) (+64)", "+64"],
               ["Chile (+56)", "+56"],
               ["China (PRC) (+86)", "+86"],
               ["Christmas Island (+618)", "+618"],
               ["Cocos-Keeling Islands (+61)", "+61"],
               ["Colombia (+57)", "+57"],
               ["Comoros (+269)", "+269"],
               ["Congo (+242)", "+242"],
               ["Cook Islands (+682)", "+682"],
               ["Costa Rica (+506)", "+506"],
               ["Croatia (+385)", "+385"],
               ["Cuba (+53)", "+53"],
               ["Cuba (Guantanamo Bay) (+5399)", "+5399"],
               ["Curaçao (+599)", "+599"],
               ["Cyprus (+357)", "+357"],
               ["Czech Republic (+420)", "+420"],
               ["Côte d'Ivoire (+225)", "+225"],
               ["Democratic Republic Of Congo (+243)", "+243"],
               ["Denmark (+45)", "+45"],
               ["Diego Garcia (+246)", "+246"],
               ["Djibouti (+253)", "+253"],
               ["Dominica (+1767)", "+1767"],
               ["Dominican Republic  (+1809)", "+1809"],
               ["Dominican Republic  (+1829)", "+1829"],
               ["EMSAT (+88213)", "+88213"],
               ["East Timor (+670)", "+670"],
               ["Easter Island (+56)", "+56"],
               ["Ecuador  (+593)", "+593"],
               ["Egypt (+20)", "+20"],
               ["El Salvador (+503)", "+503"],
               ["Ellipso (+8812)", "+8812"],
               ["Ellipso (+8813)", "+8813"],
               ["Equatorial Guinea (+240)", "+240"],
               ["Eritrea (+291)", "+291"],
               ["Estonia (+372)", "+372"],
               ["Ethiopia (+251)", "+251"],
               ["Falkland Islands (Malvinas) (+500)", "+500"],
               ["Faroe Islands (+298)", "+298"],
               ["Fiji Islands (+679)", "+679"],
               ["Finland (+358)", "+358"],
               ["France (+33)", "+33"],
               ["French Antilles (+596)", "+596"],
               ["French Guiana (+594)", "+594"],
               ["French Polynesia (+689)", "+689"],
               ["Gabonese Republic (+241)", "+241"],
               ["Gambia (+220)", "+220"],
               ["Georgia (+995)", "+995"],
               ["Germany (+49)", "+49"],
               ["Ghana (+233)", "+233"],
               ["Gibraltar (+350)", "+350"],
               ["GMSS (+881)", "+881"],
               ["GMSS Ellipso (+8812)", "+8812"],
               ["GMSS Ellipso (+8813)", "+8813"],
               ["GMSS Globalstar (+8818)", "+8818"],
               ["GMSS Globalstar (+8819)", "+8819"],
               ["GMSS ICO Global (+8810)", "+8810"],
               ["GMSS ICO Global (+8811)", "+8811"],
               ["GMSS Iridium (+8816)", "+8816"],
               ["GMSS Iridium (+8817)", "+8817"],
               ["Greece  (+30)", "+30"],
               ["Greenland (+299)", "+299"],
               ["Grenada (+1473)", "+1473"],
               ["Guadeloupe (+590)", "+590"],
               ["Guam (+1671)", "+1671"],
               ["Guantanamo Bay (+5399)", "+5399"],
               ["Guatemala (+502)", "+502"],
               ["Guinea (+224)", "+224"],
               ["Guinea-Bissau  (+245)", "+245"],
               ["Guyana (+592)", "+592"],
               ["Haiti (+509)", "+509"],
               ["Honduras (+504)", "+504"],
               ["Hong Kong (+852)", "+852"],
               ["Hungary  (+36)", "+36"],
               ["Iceland (+354)", "+354"],
               ["India (+91)", "+91"],
               ["Indonesia (+62)", "+62"],
               ["Inmarsat (Atlantic Ocean - East) (+871)", "+871"],
               ["Inmarsat (Atlantic Ocean - West) (+874)", "+874"],
               ["Inmarsat (Indian Ocean) (+873)", "+873"],
               ["Inmarsat (Pacific Ocean) (+872)", "+872"],
               ["Inmarsat SNAC (+870)", "+870"],
               ["International Freephone Service (+800)", "+800"],
               ["ISCS (+808)", "+808"],
               ["Iran (+98)", "+98"],
               ["Iraq (+964)", "+964"],
               ["Ireland (+353)", "+353"],
               ["Israel (+972)", "+972"],
               ["Italy (+39)", "+39"],
               ["Jamaica (+1876)", "+1876"],
               ["Japan (+81)", "+81"],
               ["Jordan (+962)", "+962"],
               ["Kazakhstan (+7)", "+7"],
               ["Kenya (+254)", "+254"],
               ["Kiribati  (+686)", "+686"],
               ["Korea (North) (+850)", "+850"],
               ["Korea (South) (+82)", "+82"],
               ["Kuwait (+965)", "+965"],
               ["Kyrgyz Republic (+996)", "+996"],
               ["Laos (+856)", "+856"],
               ["Latvia (+371)", "+371"],
               ["Lebanon (+961)", "+961"],
               ["Lesotho (+266)", "+266"],
               ["Liberia (+231)", "+231"],
               ["Libya (+218)", "+218"],
               ["Liechtenstein (+423)", "+423"],
               ["Lithuania (+370)", "+370"],
               ["Luxembourg (+352)", "+352"],
               ["Macao (+853)", "+853"],
               ["Macedonia (+389)", "+389"],
               ["Madagascar (+261)", "+261"],
               ["Malawi (+265)", "+265"],
               ["Malaysia (+60)", "+60"],
               ["Maldives (+960)", "+960"],
               ["Mali Republic (+223)", "+223"],
               ["Malta (+356)", "+356"],
               ["Marshall Islands (+692)", "+692"],
               ["Martinique (+596)", "+596"],
               ["Mauritania (+222)", "+222"],
               ["Mauritius (+230)", "+230"],
               ["Mayotte Island (+269)", "+269"],
               ["Mexico (+52)", "+52"],
               ["Micronesia (+691)", "+691"],
               ["Midway Island (+1808)", "+1808"],
               ["Moldova (+373)", "+373"],
               ["Monaco (+377)", "+377"],
               ["Mongolia (+976)", "+976"],
               ["Montenegro (+382)", "+382"],
               ["Montserrat (+1664)", "+1664"],
               ["Morocco (+212)", "+212"],
               ["Mozambique (+258)", "+258"],
               ["Myanmar (+95)", "+95"],
               ["Namibia (+264)", "+264"],
               ["Nauru (+674)", "+674"],
               ["Nepal (+977)", "+977"],
               ["Netherlands (+31)", "+31"],
               ["Netherlands Antilles (+599)", "+599"],
               ["Nevis (+1869)", "+1869"],
               ["New Caledonia (+687)", "+687"],
               ["New Zealand (+64)", "+64"],
               ["Nicaragua (+505)", "+505"],
               ["Niger (+227)", "+227"],
               ["Nigeria (+234)", "+234"],
               ["Niue (+683)", "+683"],
               ["Norfolk Island (+672)", "+672"],
               ["Northern Marianas Islands (+1670)", "+1670"],
               ["Norway (+47)", "+47"],
               ["Oman (+968)", "+968"],
               ["Pakistan (+92)", "+92"],
               ["Palau (+680)", "+680"],
               ["Palestinian Settlements (+970)", "+970"],
               ["Panama (+507)", "+507"],
               ["Papua New Guinea (+675)", "+675"],
               ["Paraguay (+595)", "+595"],
               ["Peru (+51)", "+51"],
               ["Philippines (+63)", "+63"],
               ["Poland (+48)", "+48"],
               ["Portugal (+351)", "+351"],
               ["Puerto Rico (+1787)", "+1787"],
               ["Puerto Rico (+1939)", "+1939"],
               ["Qatar (+974)", "+974"],
               ["Romania (+40)", "+40"],
               ["Russia (+7)", "+7"],
               ["Rwandese Republic (+250)", "+250"],
               ["Réunion Island (+262)", "+262"],
               ["Samoa (+685)", "+685"],
               ["San Marino (+378)", "+378"],
               ["Saudi Arabia (+966)", "+966"],
               ["Senegal (+221)", "+221"],
               ["Serbia (+381)", "+381"],
               ["Seychelles Republic (+248)", "+248"],
               ["Sierra Leone (+232)", "+232"],
               ["Singapore (+65)", "+65"],
               ["Slovak Republic (+421)", "+421"],
               ["Slovenia (+386)", "+386"],
               ["Solomon Islands (+677)", "+677"],
               ["Somali Democratic Republic (+252)", "+252"],
               ["South Africa (+27)", "+27"],
               ["Spain (+34)", "+34"],
               ["Sri Lanka (+94)", "+94"],
               ["St. Helena (+290)", "+290"],
               ["St. Kitts/Nevis (+1869)", "+1869"],
               ["St. Lucia (+1758)", "+1758"],
               ["St. Pierre & Miquelon (+508)", "+508"],
               ["St. Vincent & Grenadines (+1784)", "+1784"],
               ["Sudan (+249)", "+249"],
               ["Suriname (+597)", "+597"],
               ["Swaziland (+268)", "+268"],
               ["Sweden (+46)", "+46"],
               ["Switzerland (+41)", "+41"],
               ["Syria (+963)", "+963"],
               ["São Tomé and Principe (+239)", "+239"],
               ["Taiwan (+886)", "+886"],
               ["Tajikistan (+992)", "+992"],
               ["Tanzania (+255)", "+255"],
               ["Thailand (+66)", "+66"],
               ["Thuraya (+88216)", "+88216"],
               ["Timor Leste (+670)", "+670"],
               ["Togolese Republic (+228)", "+228"],
               ["Tokelau (+690)", "+690"],
               ["Tonga Islands (+676)", "+676"],
               ["Trinidad & Tobago (+1868)", "+1868"],
               ["Tunisia (+216)", "+216"],
               ["Turkey (+90)", "+90"],
               ["Turkmenistan  (+993)", "+993"],
               ["Turks and Caicos Islands (+1649)", "+1649"],
               ["Tuvalu (+688)", "+688"],
               ["US Virgin Islands (+1340)", "+1340"],
               ["Uganda (+256)", "+256"],
               ["Ukraine (+380)", "+380"],
               ["United Arab Emirates (+971)", "+971"],
               ["United Kingdom (+44)", "+44"],
               ["United States of America (+1)", "+1"],
               ["UPT (+878)", "+878"],
               ["Uruguay (+598)", "+598"],
               ["Uzbekistan (+998)", "+998"],
               ["Vanuatu (+678)", "+678"],
               ["Vatican City (+379)", "+379"],
               ["Vatican City (+39)", "+39"],
               ["Venezuela (+58)", "+58"],
               ["Vietnam (+84)", "+84"],
               ["Wake Island (+808)", "+808"],
               ["Wallis and Futuna Islands (+681)", "+681"],
               ["Yemen (+967)", "+967"],
               ["Zambia (+260)", "+260"],
               ["Zanzibar (+255)", "+255"],
               ["Zimbabwe (+263)", "+263"]]
end
